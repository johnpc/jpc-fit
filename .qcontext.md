# JPC Fit - Project Context

## Project Overview

A dead-simple daily calorie tracking app for web and iOS with HealthKit integration. Data resets daily for a fresh start each day.

## Reference Implementation

Original source code is preserved at `/Users/xss/repo/jpc-fit-2` for reference during refactoring.

## Refactoring Goals

### Data Management Migration
- **Current**: Direct Amplify client calls with local state management
- **Target**: TanStack Query (react-query) for all server state
- **Pattern**: Providers + Hooks architecture

### Key Requirements
- Replace direct Amplify calls with TanStack Query hooks
- Implement providers/hooks for Amplify subscriptions
- Use custom hooks for data operations (e.g., `useFood`, `useWeight`, `useGoal`)
- Centralize subscription management in providers
- Remove manual state management - let TanStack Query handle caching
- Keep subscription logic separate from component logic

## What to Keep (DO NOT MODIFY)

- **Backend**: All Amplify Gen 2 resources in `/amplify` (auth, data, storage)
- **Icons**: All icons in `/icons`
- **Build Strategy**: Capacitor configuration and build setup
- **PWA Structure**: Everything in `/public`
- **MUI Dependencies**: Material-UI for tabbed layout and UI components
- **HealthKit Integration**: `@perfood/capacitor-healthkit` for iOS health data

## Technology Stack

- **Framework**: React + TypeScript + Vite
- **Backend**: AWS Amplify Gen 2 (Auth, Data, Storage)
- **State Management**: TanStack Query (react-query) for server state
- **UI Library**: Material-UI (@mui/material)
- **Native Features**: Capacitor for iOS/web
  - HealthKit integration via `@perfood/capacitor-healthkit`
  - Local notifications via `@capacitor/local-notifications`
  - Preferences storage via `@capacitor/preferences`
- **Date Handling**: date-fns

## Core Features

### Daily Calorie Tracking
- Add food items with calorie counts
- Quick-add buttons for common foods
- View daily total vs goal
- Data resets each day

### Weight Tracking
- Record weight measurements
- View BMI calculations
- Body fat percentage eye test
- Historical weight data

### Stats & Insights
- Weekly overview of calorie intake
- Streak tracking for goal adherence
- Visual charts and progress indicators

### Settings & Configuration
- User preferences (calorie goals, units)
- Quick-add button configuration
- HealthKit permission management
- Account management

## Code Patterns

- **Provider Pattern**: Global state via context providers (auth, subscriptions)
- **Custom Hooks**: Data operations via TanStack Query hooks
  - `useFood()` - Food entries with queries/mutations
  - `useWeight()` - Weight tracking
  - `useGoal()` - Calorie goals
  - `usePreferences()` - User preferences
  - `useQuickAdd()` - Quick-add configurations
- **Clean Separation**: Data layer separate from UI components
- **Component Organization**: Feature-based folders (e.g., `calorie-page/`, `weight-page/`)
- **Component Size**: **Every file must be < 200 lines** - break into smaller components when needed
- **Keep Components Simple**: Single responsibility, focused on one task
- **Mobile-first**: Primary use case is mobile devices

## Directory Structure

```
/Users/xss/repo/jpc-fit-vite/
├── amplify/                    # Backend resources (KEEP)
│   ├── auth/                   # Authentication config
│   ├── data/                   # Data models
│   ├── storage/                # File storage
│   └── backend.ts              # Backend definition
├── icons/                      # App icons (KEEP)
├── public/                     # PWA assets (KEEP)
└── src/
    ├── App.tsx                 # Main app component
    ├── main.tsx                # Entry point
    ├── components/
    │   ├── TabsView.tsx        # Main tab navigation
    │   ├── Header.tsx          # App header
    │   ├── Footer.tsx          # App footer
    │   ├── CaloriePage.tsx     # Daily calorie tracking
    │   ├── WeightPage.tsx      # Weight tracking
    │   ├── StatsPage.tsx       # Statistics view
    │   ├── SettingsPage.tsx    # Settings
    │   ├── AphorismsPage.tsx   # Motivational quotes
    │   ├── FoodDetailPage.tsx  # Food item details
    │   ├── calorie-page/       # Calorie page components
    │   ├── weight-page/        # Weight page components
    │   ├── stats-page/         # Stats page components
    │   └── settings-page/      # Settings page components
    ├── data/
    │   ├── entities.ts         # Data layer with Amplify client
    │   └── cache.ts            # Cache utilities
    ├── helpers/
    │   ├── getStreakInfo.ts    # Streak calculation
    │   ├── getHealthKitData.ts # HealthKit integration
    │   └── iconMap.tsx         # Icon mappings
    ├── ui-components/          # Amplify-generated forms
    └── images/                 # Static images
```

## Data Models

Key entities in Amplify Data:
- **Food**: Daily food entries with calories
- **Weight**: Weight measurements
- **Goal**: Calorie goals
- **Preferences**: User preferences
- **QuickAdd**: Quick-add button configurations
- **Height**: Height measurements

## Key Implementation Details

### HealthKit Integration
- iOS-only feature using `@perfood/capacitor-healthkit`
- Reads active energy burned and dietary energy
- Requires user permission
- Gracefully degrades on web

### Daily Reset
- Data is scoped to current day
- Fresh start each day for calorie tracking
- Historical data preserved for stats

### Offline Support
- PWA with service worker
- Local preferences via Capacitor
- Syncs with Amplify when online

## Development Commands

```bash
# Development
npm run dev              # Start web dev server
npm run ios              # Build and open iOS

# Backend
npx amplify sandbox      # Start local backend
npm run prod-config      # Generate prod config

# Build
npm run build            # Production build
npx cap sync             # Sync Capacitor
```

## Design Philosophy

- **Simple & Focused**: Daily calorie tracking without complexity
- **Mobile-first**: Optimized for mobile devices
- **Quick Entry**: Minimal friction to log food
- **Visual Feedback**: Clear progress indicators
- **Privacy**: Data stays in user's AWS account
